<%- include('../../partials/header') %>

<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Buat Event Baru</h1>
        <p class="text-gray-600 mt-2">Bagikan event menarik Anda dengan komunitas</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
        <% if (errors && errors.length > 0) { %>
            <div class="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                <ul class="list-disc list-inside">
                    <% errors.forEach(error => { %>
                        <li><%= error %></li>
                    <% }) %>
                </ul>
            </div>
        <% } %>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            <!-- Basic Information -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Informasi Dasar</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                            Judul Event *
                        </label>
                        <input type="text" id="title" name="title" required
                               value="<%= (typeof formData !== 'undefined' && formData.title) ? formData.title : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="Contoh: Konser Jazz Malam">
                    </div>

                    <div>
                        <label for="category_id" class="block text-sm font-medium text-gray-700 mb-2">
                            Kategori *
                        </label>
                        <select id="category_id" name="category_id" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Pilih Kategori</option>
                            <% categories.forEach(category => { %>
                            <option value="<%= category.id %>" 
                                    <%= (typeof formData !== 'undefined' && formData.category_id == category.id) ? 'selected' : '' %>>
                                <%= category.name %>
                            </option>
                            <% }) %>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Description -->
            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                    Deskripsi Event *
                </label>
                <textarea id="description" name="description" rows="4" required
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                          placeholder="Jelaskan detail event Anda..."><%= (typeof formData !== 'undefined' && formData.description) ? formData.description : '' %></textarea>
            </div>

            <!-- Date & Time -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Tanggal & Waktu</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="event_date" class="block text-sm font-medium text-gray-700 mb-2">
                            Tanggal & Waktu Mulai *
                        </label>
                        <input type="datetime-local" id="event_date" name="event_date" required
                               value="<%= (typeof formData !== 'undefined' && formData.event_date) ? formData.event_date : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div>
                        <label for="event_end_date" class="block text-sm font-medium text-gray-700 mb-2">
                            Tanggal & Waktu Selesai
                        </label>
                        <input type="datetime-local" id="event_end_date" name="event_end_date"
                               value="<%= (typeof formData !== 'undefined' && formData.event_end_date) ? formData.event_end_date : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>

            <!-- Location -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Lokasi</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="venue" class="block text-sm font-medium text-gray-700 mb-2">
                            Tempat Event *
                        </label>
                        <input type="text" id="venue" name="venue" required
                            value="<%= (typeof formData !== 'undefined' && formData.venue) ? formData.venue : '' %>"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="Contoh: Gedung Serba Guna">
                    </div>
                    <div>
                        <label for="city" class="block text-sm font-medium text-gray-700 mb-2">
                            Kota *
                        </label>
                        <select id="city" name="city" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Pilih Kota</option>
                            <option value="Jakarta" <%= (typeof formData !== 'undefined' && formData.city === 'Jakarta') ? 'selected' : '' %>>Jakarta</option>
                            <option value="Bandung" <%= (typeof formData !== 'undefined' && formData.city === 'Bandung') ? 'selected' : '' %>>Bandung</option>
                            <option value="Surabaya" <%= (typeof formData !== 'undefined' && formData.city === 'Surabaya') ? 'selected' : '' %>>Surabaya</option>
                            <option value="Yogyakarta" <%= (typeof formData !== 'undefined' && formData.city === 'Yogyakarta') ? 'selected' : '' %>>Yogyakarta</option>
                            <option value="Bali" <%= (typeof formData !== 'undefined' && formData.city === 'Bali') ? 'selected' : '' %>>Bali</option>
                            <option value="Medan" <%= (typeof formData !== 'undefined' && formData.city === 'Medan') ? 'selected' : '' %>>Medan</option>
                            <option value="Semarang" <%= (typeof formData !== 'undefined' && formData.city === 'Semarang') ? 'selected' : '' %>>Semarang</option>
                            <option value="Malang" <%= (typeof formData !== 'undefined' && formData.city === 'Malang') ? 'selected' : '' %>>Malang</option>
                            <option value="Bogor" <%= (typeof formData !== 'undefined' && formData.city === 'Bogor') ? 'selected' : '' %>>Bogor</option>
                            <option value="Makassar" <%= (typeof formData !== 'undefined' && formData.city === 'Makassar') ? 'selected' : '' %>>Makassar</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Ticket Information -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Informasi Tiket</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
                            Harga Tiket (Rp) *
                        </label>
                        <input type="number" id="price" name="price" min="0" step="0.01" required
                               value="<%= (typeof formData !== 'undefined' && formData.price) ? formData.price : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="0">
                    </div>

                    <div>
                        <label for="available_tickets" class="block text-sm font-medium text-gray-700 mb-2">
                            Jumlah Tiket *
                        </label>
                        <input type="number" id="available_tickets" name="available_tickets" min="1" required
                               value="<%= (typeof formData !== 'undefined' && formData.available_tickets) ? formData.available_tickets : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="100">
                    </div>

                    <div>
                        <label for="max_attendees" class="block text-sm font-medium text-gray-700 mb-2">
                            Kapasitas Maksimal
                        </label>
                        <input type="number" id="max_attendees" name="max_attendees" min="1"
                               value="<%= (typeof formData !== 'undefined' && formData.max_attendees) ? formData.max_attendees : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="Opsional">
                    </div>
                </div>
            </div>

            <!-- Image Upload -->
            <div>
                <label for="image" class="block text-sm font-medium text-gray-700 mb-2">
                    Gambar Event
                </label>
                <div class="flex items-center justify-center w-full">
                    <label for="image" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                            </svg>
                            <p class="mb-2 text-sm text-gray-500">
                                <span class="font-semibold">Klik untuk upload</span> atau drag and drop
                            </p>
                            <p class="text-xs text-gray-500">PNG, JPG, JPEG (MAX. 5MB)</p>
                        </div>
                        <input id="image" name="image" type="file" class="hidden" accept="image/*">
                    </label>
                </div>
                <div id="image-preview" class="mt-2 hidden">
                    <img id="preview" class="h-32 rounded-lg">
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end space-x-4 pt-6 border-t">
                <a href="/events" 
                   class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
                    Batal
                </a>
                <button type="submit" 
                        class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300">
                    Buat Event
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Image preview
document.getElementById('image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('image-preview');
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.classList.remove('hidden');
        }
        reader.readAsDataURL(file);
    } else {
        previewContainer.classList.add('hidden');
    }
});

// Auto-set end date if empty
document.getElementById('event_date').addEventListener('change', function() {
    const startDate = this.value;
    const endDateInput = document.getElementById('event_end_date');
    
    if (startDate && !endDateInput.value) {
        // Set end date to 3 hours after start date by default
        const start = new Date(startDate);
        start.setHours(start.getHours() + 3);
        endDateInput.value = start.toISOString().slice(0, 16);
    }
});
</script>

<%- include('../../partials/footer') %>