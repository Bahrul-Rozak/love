<%- include('../../partials/header') %>

<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Edit Event</h1>
        <p class="text-gray-600 mt-2">Update informasi event Anda</p>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
        <% if (errors && errors.length > 0) { %>
            <div class="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                <ul class="list-disc list-inside">
                    <% errors.forEach(error => { %>
                        <li><%= error %></li>
                    <% }) %>
                </ul>
            </div>
        <% } %>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            <!-- Current Image -->
            <% if (event.image_path) { %>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Gambar Saat Ini</label>
                <img src="<%= event.image_path %>" alt="Current event image" class="w-48 h-32 object-cover rounded-lg">
            </div>
            <% } %>

            <!-- Form fields sama seperti create.ejs, tapi dengan value dari event -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Informasi Dasar</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                            Judul Event *
                        </label>
                        <input type="text" id="title" name="title" required
                               value="<%= event.title %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div>
                        <label for="category_id" class="block text-sm font-medium text-gray-700 mb-2">
                            Kategori *
                        </label>
                        <select id="category_id" name="category_id" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            <% categories.forEach(category => { %>
                            <option value="<%= category.id %>" 
                                    <%= event.category_id == category.id ? 'selected' : '' %>>
                                <%= category.name %>
                            </option>
                            <% }) %>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Lanjutkan dengan field lainnya seperti di create.ejs -->
            <!-- Description -->
            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                    Deskripsi Event *
                </label>
                <textarea id="description" name="description" rows="4" required
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"><%= event.description %></textarea>
            </div>

            <!-- Date & Time -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Tanggal & Waktu</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="event_date" class="block text-sm font-medium text-gray-700 mb-2">
                            Tanggal & Waktu Mulai *
                        </label>
                        <input type="datetime-local" id="event_date" name="event_date" required
                               value="<%= new Date(event.event_date).toISOString().slice(0, 16) %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>

                    <div>
                        <label for="event_end_date" class="block text-sm font-medium text-gray-700 mb-2">
                            Tanggal & Waktu Selesai
                        </label>
                        <input type="datetime-local" id="event_end_date" name="event_end_date"
                               value="<%= event.event_end_date ? new Date(event.event_end_date).toISOString().slice(0, 16) : '' %>"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>

            <!-- Lanjutkan dengan field lainnya... -->
            <!-- Location -->
<div>
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Lokasi</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="venue" class="block text-sm font-medium text-gray-700 mb-2">
                Tempat Event *
            </label>
            <input type="text" id="venue" name="venue" required
                   value="<%= (typeof formData !== 'undefined' && formData.venue) ? formData.venue : event.venue %>"
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                   placeholder="Contoh: Gedung Serba Guna">
        </div>
        <div>
            <label for="city" class="block text-sm font-medium text-gray-700 mb-2">
                Kota *
            </label>
            <select id="city" name="city" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option value="">Pilih Kota</option>
                <option value="Jakarta" <%= ((typeof formData !== 'undefined' && formData.city === 'Jakarta') || event.city === 'Jakarta') ? 'selected' : '' %>>Jakarta</option>
                <option value="Bandung" <%= ((typeof formData !== 'undefined' && formData.city === 'Bandung') || event.city === 'Bandung') ? 'selected' : '' %>>Bandung</option>
                <option value="Surabaya" <%= ((typeof formData !== 'undefined' && formData.city === 'Surabaya') || event.city === 'Surabaya') ? 'selected' : '' %>>Surabaya</option>
                <option value="Yogyakarta" <%= ((typeof formData !== 'undefined' && formData.city === 'Yogyakarta') || event.city === 'Yogyakarta') ? 'selected' : '' %>>Yogyakarta</option>
                <option value="Bali" <%= ((typeof formData !== 'undefined' && formData.city === 'Bali') || event.city === 'Bali') ? 'selected' : '' %>>Bali</option>
                <option value="Medan" <%= ((typeof formData !== 'undefined' && formData.city === 'Medan') || event.city === 'Medan') ? 'selected' : '' %>>Medan</option>
                <option value="Semarang" <%= ((typeof formData !== 'undefined' && formData.city === 'Semarang') || event.city === 'Semarang') ? 'selected' : '' %>>Semarang</option>
                <option value="Malang" <%= ((typeof formData !== 'undefined' && formData.city === 'Malang') || event.city === 'Malang') ? 'selected' : '' %>>Malang</option>
                <option value="Bogor" <%= ((typeof formData !== 'undefined' && formData.city === 'Bogor') || event.city === 'Bogor') ? 'selected' : '' %>>Bogor</option>
                <option value="Makassar" <%= ((typeof formData !== 'undefined' && formData.city === 'Makassar') || event.city === 'Makassar') ? 'selected' : '' %>>Makassar</option>
            </select>
        </div>
    </div>
</div>

            <!-- Submit Buttons -->
            <div class="flex justify-between items-center pt-6 border-t">
                <a href="/my-events" 
                   class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
                    Batal
                </a>
                <div class="space-x-4">
                    <a href="/events/<%= event.id %>" 
                       class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-300">
                        Lihat Event
                    </a>
                    <button type="submit" 
                            class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300">
                        Update Event
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Sama seperti di create.ejs
document.getElementById('image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('image-preview');
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.classList.remove('hidden');
        }
        reader.readAsDataURL(file);
    } else {
        previewContainer.classList.add('hidden');
    }
});
</script>

<%- include('../../partials/footer') %>