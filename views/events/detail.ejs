<%- include('../../partials/header') %>

<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav class="flex mb-8" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-gray-500">
            <li><a href="/" class="hover:text-indigo-600 flex items-center">
                <i class="fas fa-home mr-1"></i>Home
            </a></li>
            <li><i class="fas fa-chevron-right text-xs"></i></li>
            <li><a href="/events" class="hover:text-indigo-600 flex items-center">
                <i class="fas fa-calendar-alt mr-1"></i>Events
            </a></li>
            <li><i class="fas fa-chevron-right text-xs"></i></li>
            <li class="text-gray-900 font-medium flex items-center">
                <i class="fas fa-ticket-alt mr-1"></i><%= event.title %>
            </li>
        </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2">
            <!-- Event Image -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-6 border border-gray-100">
                <img src="<%= event.image_path || '/images/event-placeholder.jpg' %>" 
                     alt="<%= event.title %>" 
                     class="w-full h-96 object-cover">
            </div>

            <!-- Event Details -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-6 border border-gray-100">
                <div class="flex items-center justify-between mb-6">
                    <span class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center shadow-lg">
                        <i class="fas fa-tag mr-2"></i>
                        <%= event.Category.name %>
                    </span>
                    <span class="text-3xl font-bold text-indigo-600">
                        Rp <%= Number(event.price).toLocaleString('id-ID') %>
                    </span>
                </div>

                <h1 class="text-4xl font-bold text-gray-900 mb-6 leading-tight"><%= event.title %></h1>
                
                <div class="prose max-w-none text-gray-600 mb-8 text-lg leading-relaxed">
                    <p><%= event.description %></p>
                </div>

                <!-- Event Info Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="space-y-6">
                        <!-- Date & Time -->
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                <i class="fas fa-calendar-alt text-indigo-600 text-lg"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 font-medium mb-1">Tanggal & Waktu</p>
                                <p class="font-semibold text-gray-900 text-lg">
                                    <%= new Date(event.event_date).toLocaleDateString('id-ID', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    }) %>
                                </p>
                                <p class="text-gray-600">
                                    <i class="fas fa-clock mr-1 text-indigo-500"></i>
                                    <%= new Date(event.event_date).toLocaleTimeString('id-ID', { 
                                        hour: '2-digit', 
                                        minute: '2-digit' 
                                    }) %>
                                    <% if (event.event_end_date) { %>
                                        - <%= new Date(event.event_end_date).toLocaleTimeString('id-ID', { 
                                            hour: '2-digit', 
                                            minute: '2-digit' 
                                        }) %>
                                    <% } %>
                                </p>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-cyan-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                <i class="fas fa-map-marker-alt text-blue-600 text-lg"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 font-medium mb-1">Lokasi</p>
                                <p class="font-semibold text-gray-900 text-lg"><%= event.venue %></p>
                                <p class="text-gray-600 flex items-center">
                                    <i class="fas fa-city mr-1 text-blue-500"></i>
                                    <%= event.city || 'Online' %>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Organizer -->
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-100 to-emerald-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                <i class="fas fa-user text-green-600 text-lg"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 font-medium mb-1">Penyelenggara</p>
                                <p class="font-semibold text-gray-900 text-lg"><%= event.User.name %></p>
                                <p class="text-gray-600 flex items-center">
                                    <i class="fas fa-envelope mr-1 text-green-500"></i>
                                    <%= event.User.email %>
                                </p>
                                <% if (event.User.phone) { %>
                                <p class="text-gray-600 flex items-center">
                                    <i class="fas fa-phone mr-1 text-green-500"></i>
                                    <%= event.User.phone %>
                                </p>
                                <% } %>
                            </div>
                        </div>

                        <!-- Tickets -->
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-100 to-red-100 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                <i class="fas fa-ticket-alt text-orange-600 text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-500 font-medium mb-1">Tiket Tersedia</p>
                                <p class="font-semibold text-gray-900 text-lg">
                                    <%= event.available_tickets %> / <%= event.max_attendees || 'Tidak terbatas' %>
                                </p>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full" 
                                         style="width: <%= Math.min((event.available_tickets / (event.max_attendees || event.available_tickets + 10)) * 100, 100) %>%">
                                    </div>
                                </div>
                                <p class="text-sm mt-1 <%= event.available_tickets > 0 ? 'text-green-600' : 'text-red-600' %>">
                                    <i class="fas <%= event.available_tickets > 0 ? 'fa-check-circle' : 'fa-times-circle' %> mr-1"></i>
                                    <% if (event.available_tickets > 0) { %>
                                        Masih tersedia
                                    <% } else { %>
                                        Sold Out
                                    <% } %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="border-t pt-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-info-circle mr-3 text-indigo-600"></i>
                        Informasi Tambahan
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="flex items-center p-4 bg-gray-50 rounded-xl">
                            <i class="fas fa-tags text-indigo-600 text-xl mr-4"></i>
                            <div>
                                <p class="text-sm text-gray-500">Kategori</p>
                                <p class="font-semibold text-gray-900"><%= event.Category.name %></p>
                            </div>
                        </div>
                        <div class="flex items-center p-4 bg-gray-50 rounded-xl">
                            <i class="fas fa-money-bill-wave text-green-600 text-xl mr-4"></i>
                            <div>
                                <p class="text-sm text-gray-500">Harga Tiket</p>
                                <p class="font-semibold text-gray-900">Rp <%= Number(event.price).toLocaleString('id-ID') %></p>
                            </div>
                        </div>
                        <% if (event.max_attendees) { %>
                        <div class="flex items-center p-4 bg-gray-50 rounded-xl">
                            <i class="fas fa-users text-blue-600 text-xl mr-4"></i>
                            <div>
                                <p class="text-sm text-gray-500">Kapasitas</p>
                                <p class="font-semibold text-gray-900"><%= event.max_attendees %> orang</p>
                            </div>
                        </div>
                        <% } %>
                        <div class="flex items-center p-4 bg-gray-50 rounded-xl">
                            <i class="fas fa-calendar-plus text-purple-600 text-xl mr-4"></i>
                            <div>
                                <p class="text-sm text-gray-500">Dibuat pada</p>
                                <p class="font-semibold text-gray-900">
                                    <%= new Date(event.created_at).toLocaleDateString('id-ID') %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar - Action Card -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-6 border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-shopping-cart mr-3 text-indigo-600"></i>
                    Beli Tiket
                </h3>
                
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-600 flex items-center">
                            <i class="fas fa-ticket-alt mr-2 text-indigo-500"></i>
                            Harga per tiket
                        </span>
                        <span class="font-bold text-indigo-600">Rp <%= Number(event.price).toLocaleString('id-ID') %></span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-600 flex items-center">
                            <i class="fas fa-box-open mr-2 text-green-500"></i>
                            Tiket tersedia
                        </span>
                        <span class="font-bold <%= event.available_tickets > 0 ? 'text-green-600' : 'text-red-600' %>">
                            <%= event.available_tickets %>
                        </span>
                    </div>
                </div>

                <% if (event.available_tickets > 0) { %>
                    <% if (user) { %>
                        <a href="/events/<%= event.id %>/checkout" 
                           class="group w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-center py-4 rounded-xl font-bold hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            <i class="fas fa-credit-card mr-3 group-hover:scale-110 transition-transform duration-300"></i>
                            Beli Tiket Sekarang
                            <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-300"></i>
                        </a>
                    <% } else { %>
                        <div class="space-y-4">
                            <a href="/login" 
                               class="group w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-center py-4 rounded-xl font-bold hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <i class="fas fa-sign-in-alt mr-3"></i>
                                Login untuk Membeli
                            </a>
                            <p class="text-sm text-gray-500 text-center flex items-center justify-center">
                                <i class="fas fa-user-plus mr-2 text-indigo-500"></i>
                                Belum punya akun? 
                                <a href="/register" class="text-indigo-600 hover:underline font-semibold ml-1">
                                    Daftar di sini
                                </a>
                            </p>
                        </div>
                    <% } %>
                <% } else { %>
                    <button disabled
                            class="w-full bg-gray-400 text-white text-center py-4 rounded-xl font-bold cursor-not-allowed flex items-center justify-center">
                        <i class="fas fa-times-circle mr-3"></i>
                        Tiket Habis
                    </button>
                <% } %>

                <!-- Share Event -->
                <div class="mt-8 pt-6 border-t">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-share-alt mr-2 text-indigo-600"></i>
                        Bagikan Event
                    </h4>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="shareEvent('facebook')" 
                                class="group bg-blue-600 text-white py-3 rounded-xl text-sm font-semibold hover:bg-blue-700 transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-xl">
                            <i class="fab fa-facebook-f mr-2 group-hover:scale-110 transition-transform duration-300"></i>
                            FB
                        </button>
                        <button onclick="shareEvent('twitter')" 
                                class="group bg-blue-400 text-white py-3 rounded-xl text-sm font-semibold hover:bg-blue-500 transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-xl">
                            <i class="fab fa-twitter mr-2 group-hover:scale-110 transition-transform duration-300"></i>
                            TW
                        </button>
                        <button onclick="shareEvent('whatsapp')" 
                                class="group bg-green-500 text-white py-3 rounded-xl text-sm font-semibold hover:bg-green-600 transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-xl">
                            <i class="fab fa-whatsapp mr-2 group-hover:scale-110 transition-transform duration-300"></i>
                            WA
                        </button>
                    </div>
                </div>

                <!-- Safety Info -->
                <div class="mt-6 pt-6 border-t">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-shield-alt mr-2 text-green-600"></i>
                        Tips Keamanan
                    </h4>
                    <ul class="text-sm text-gray-600 space-y-3">
                        <li class="flex items-start p-3 bg-green-50 rounded-lg">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-0.5"></i>
                            <span>Selalu bertemu di tempat umum</span>
                        </li>
                        <li class="flex items-start p-3 bg-green-50 rounded-lg">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-0.5"></i>
                            <span>Jangan membayar di luar platform</span>
                        </li>
                        <li class="flex items-start p-3 bg-green-50 rounded-lg">
                            <i class="fas fa-check-circle text-green-500 mr-3 mt-0.5"></i>
                            <span>Simpan bukti pembayaran</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function shareEvent(platform) {
    const url = window.location.href;
    const title = '<%= event.title %>';
    const text = 'Lihat event menarik ini: <%= event.title %>';

    let shareUrl = '';
    
    switch(platform) {
        case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            break;
        case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            break;
        case 'whatsapp':
            shareUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
            break;
    }

    window.open(shareUrl, '_blank', 'width=600,height=400');
}
</script>

<%- include('../../partials/footer') %>